===S.T.A.L.K.E.R. *.spawn compiler/decompiler for every build from 1465===

Дата последних правок: 30 августа 2011

Кратко: данный acdc предназначен для распаковки all.spawn/level.spawn от любого билда, начиная с 1465. Информацию
о версии спавна скрипт берет из параметров cse_abstract первой читаемой секции (version и script_version), 
в соответствии с чем и распаковывает спавн. Принадлежность объектов к уровням определяется по game.graph.

Добавлена также экспериментальная функция конвертирования спавна из одной версии в другую. На данный момент
поддерживаются все версии сталкера, начиная со 2го патча ТЧ.

Добавлена поддержка спавнов модов. Вылет "unknown section" исключен.

Для корректной работы используйте с папкой stkutils

Использование:
Кладете all.spawn (или level.spawn) и game.graph в папку с программой, делаете батник (команды ниже),
запускаете батник, радуетесь жизни. Если распаковываете level.spawn, game.graph, очевидно, не нужен.

===[Распаковка спавна]===
Команда:  acdc -d all.spawn [-o outdir] [-l]

-o <outdir> - папка для распакованного спавна. Если не задана, спавн распаковывается в корневую папку
-l - ключ для декомпиляции level.spawn
-scan <scan_dir> - путь до папки конфигов геймдаты мода. Путь не должен содержать кириллицу или пробелы.
Как вариант, можно положить папку config в папку с acdc и запускать с таким ключом: -scan config\

===[Запаковка спавна]===
Команда:  acdc -c all.ltx [-o outfile] [-l]

-o <outfile> - имя результирующего спавна. Если не задано - new.spawn.
-l - ключ для компиляции level.spawn

===[Конвертирование спавна]===
Команда:  acdc -convert <location> [-game1 game1,<old_gvid0>] [-game2 <game2>,<new_gvid0>] [-way]

<location> - название локации, для которой конвертируется спавн. Для конвертации спавна всех локаций из all.spawn 
ставить all.

-game1 - задание старой версии спавна в формате <ключ старой версии>,<старый начальный game_vertex_id локации>.
Разделитель - запятая, без пробелов!
-game2 - задание новой версии спавна в формате <ключ новой версии>,<новый начальный game_vertex_id локации>.
Разделитель - запятая, без пробелов!
-way - заставляет программу также обрабатывать way.

Также поддерживается тонкая настройка конвертации через файл convert.ini. В секции sections есть два параметра:
to_exclude и to_change. В качестве значений to_exclude прописываются имена секций, которые необходимо удалять при 
конвертации (например, respawn не нужен при переносе в ЗП). В качестве значений to_change прописываются 
section_name тех секций, в которых нужно что-то поменять или дополнить. Далее заполняете файл секциями для тех 
section_name, которые вы прописали в to_change. Пример:

[inventory_box]			//section_name для нужных секций
add:custom_data = PREVED	//префикс add используется для тех параметров, в которые нужно добавить
add:game_vertex_id = 10000	//необходимое значение (если число - складывается, если строка - добавляется в конец)
rep:level_vertex_id = 0		//префикс rep используется для параметров, которые необходимо заменить на что-то

Пример: acdc -convert escape -game1 cs4,472 -game2 cop,934 -way

Список ключей версий:

-soc1 - ТЧ, начиная со 2го патча, а также билд 3120
-cs0 - финалка ЧН
-cs3 - 3 патч ЧН
-cs4 - 4 патч ЧН и выше
-cop - ЗП (любой патч)

===[Массовая замена вертексов]===
Команда:  acdc -parse <location> [-game1 <old_gvid0>] [-game2 <new_gvid0>] [-way]

<location> - имя ltx, в котором находится спавн.
-game1 - задание старого начального game_vertex_id локации.
-game2 - задание нового начального game_vertex_id локации.
-way - заставляет программу также обрабатывать way.

Пример: acdc -parse alife_l01_escape.ltx -game1 0 -game2 934 -way

======================================
	

История правок:
30 августа 2011:
	[i] переделан алгоритм сканирования конфигов
	[i] добавлена поддержка спавна NLC6

26 июля 2011:
	[i] исправлены разные ошибки
	[i] ключ -2942 больше не поддерживается - acdc теперь автоматически корректирует алгоритм распаковки для 
	первого	патча ТЧ.

25 июля 2011:
	[+] импортер game.graph вынесен в отдельный модуль.
	[+] все модули переведены на вывод дебаг сообщений вместо маловнятного "died on line ..."
	[i] исправлена распаковка спавнов билдов 2212-2218 (вылет 'no such level for vertice')
	[i] исправлена распаковка спавнов билда 2232 (вылет по m_rat_e)
	[i] исправлена распаковка спавна билда 1902.

11 июля 2011
	[+] добавлен вывод дебаг-сообщений для лучшего понимания вылетов скриптов.
 	[i] исправлена распаковка некоторых мод-спавнов.

20 июня 2011
	[i] секции в конвертированном спавне теперь сортируются по алфавиту относительно section_name

19 июня 2011
	[+] добавлен конфигурационный файл для тонкой настройки конвертации спавна.
	[i] переработана функция конвертации спавна. Полностью поддерживается конвертация из ТЧ в более поздние
спавны.

9 июня 2011
	[+] добавлена поддержка спавнов модов.
	[i] исправлено определение класса m_rat_e при использовании таких секций в финалках.

7 июня 2011
	[i] исправлены ошибки распаковки и запаковки ряда билдов.

23 мая 2011
	[i] исправлены некоторые ошибки чтения графа.

18 мая 2011
	[+] добавлена поддержка встроенных в спавн графов.

17 мая 2011
	[i] исправлены stkutils, в прошлую версию попали модули от обычного acdc
	[+] добавлена функция массовой замены вертексов в распакованном спавне
	[+] добавлена функция определения принадлежности объекта к уровню по глобальному графу. 
Больше никакой возни с level.pm

15 мая 2011
	[i] исправлена распаковка некоторых level.spawn от третьего патча ЧН.
================================================================
Копирайты:
ACDC для ТЧ - bardak, для ЗП - bardak, Kolmogor. Все остальное - K.D.
Используйте/выкладывайте где и как хотите, с указанием авторов.